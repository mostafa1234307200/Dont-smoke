import streamlit as st
import numpy as np
import cv2
from PIL import Image

# Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØµÙØ­Ø©
st.set_page_config(
    page_title="Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ø£Ø±Ø¯Ù† Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ø§Ù„Ù…Ø®ØªÙ„Ø·Ø©",
    layout="centered",
    page_icon="ğŸš­",
)

# ØªÙ†Ø³ÙŠÙ‚ CSS - Ø®Ù„ÙÙŠØ© Ø¬Ù…ÙŠÙ„Ø© + ØªÙ†Ø³ÙŠÙ‚ Ø²Ø± Ø§Ù„Ø±ÙØ¹
st.markdown("""
    <style>
        .stApp {
            background-color: #e6f2ff;
            padding: 2rem;
        }
        h1, h3 {
            color: #1b3a57;
            text-align: center;
        }
        .small {
            text-align: center;
            color: #444;
            margin-bottom: 30px;
        }
        .upload-box {
            border: 2px dashed #3399cc;
            border-radius: 10px;
            padding: 20px;
            background-color: #f0f9ff;
            text-align: center;
        }
    </style>
""", unsafe_allow_html=True)

# Ø¹Ù†ÙˆØ§Ù†
st.markdown("<h1>Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ø£Ø±Ø¯Ù† Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ø§Ù„Ù…Ø®ØªÙ„Ø·Ø©</h1>", unsafe_allow_html=True)
st.markdown("<h3>ÙƒÙŠÙ Ø³ØªØ¨Ø¯Ùˆ Ø¨Ø¹Ø¯ 30 Ø³Ù†Ø© Ù…Ù† Ø§Ù„ØªØ¯Ø®ÙŠÙ†ØŸ</h3>", unsafe_allow_html=True)
st.markdown("<p class='small'>Ø§Ø±ÙØ¹ ØµÙˆØ±ØªÙƒ Ù„ØªØ´Ø§Ù‡Ø¯ ØªØ£Ø«ÙŠØ± Ø§Ù„ØªØ¯Ø®ÙŠÙ† Ø¨Ø´ÙƒÙ„ ÙˆØ§Ù‚Ø¹ÙŠ Ø¹Ù„Ù‰ Ù…Ø¸Ù‡Ø±Ùƒ</p>", unsafe_allow_html=True)

# Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© Ø¨Ø´ÙƒÙ„ Ø£Ù†ÙŠÙ‚
st.markdown('<div class="upload-box">', unsafe_allow_html=True)
uploaded_file = st.file_uploader("Ø§Ø®ØªØ± ØµÙˆØ±Ø© Ù…Ù† Ø¬Ù‡Ø§Ø²Ùƒ Ø£Ùˆ Ø§Ù„ØªÙ‚Ø· ØµÙˆØ±Ø© Ø¨Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§", type=["jpg", "jpeg", "png"])
st.markdown('</div>', unsafe_allow_html=True)

# Ø¯Ø§Ù„Ø© ØªØ£Ø«ÙŠØ± Ø§Ù„ØªØ¯Ø®ÙŠÙ†
def apply_smoking_effect(img):
    img = cv2.cvtColor(img, cv2.COLOR_RGB2BGR)

    # Ø§ØµÙØ±Ø§Ø± Ø§Ù„Ø¨Ø´Ø±Ø©
    yellow_tint = np.full_like(img, (0, 40, 80))
    img = cv2.addWeighted(img, 0.7, yellow_tint, 0.3, 0)

    # ØªØºÙ…ÙŠÙ‚ Ø§Ù„Ø´ÙØ§Ù‡
    hsv = cv2.cvtColor(img, cv2.COLOR_BGR2HSV)
    lip_mask = cv2.inRange(hsv, (0, 20, 50), (180, 255, 255))
    img[lip_mask > 0] = img[lip_mask > 0] * 0.3

    # Ø¥Ø¶Ø§ÙØ© ØªØ¬Ø§Ø¹ÙŠØ¯
    gray = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)
    edges = cv2.Canny(gray, 50, 150)
    edges = cv2.cvtColor(edges, cv2.COLOR_GRAY2BGR)
    result = cv2.addWeighted(img, 0.85, edges, 0.15, 0)

    return cv2.cvtColor(result, cv2.COLOR_BGR2RGB)

# Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø©
if uploaded_file is not None:
    image = Image.open(uploaded_file).convert("RGB")
    img_np = np.array(image)

    st.image(img_np, caption="ØµÙˆØ±ØªÙƒ Ø§Ù„Ø£ØµÙ„ÙŠØ©", use_column_width=True)

    with st.spinner("Ø¬Ø§Ø±Ù ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØ£Ø«ÙŠØ±..."):
        result = apply_smoking_effect(img_np)
        st.image(result, caption="Ø¨Ø¹Ø¯ 30 Ø³Ù†Ø© Ù…Ù† Ø§Ù„ØªØ¯Ø®ÙŠÙ†", use_column_width=True)
        st.success("ØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØ£Ø«ÙŠØ± Ø¨Ù†Ø¬Ø§Ø­!")